# Introduction

Infrastructure as code (IaC) is the process of managing and provisioning computer data centers through machine-readable definition files, rather than physical hardware configuration or interactive configuration tools.

Terraform is a tool for building, changing, and versioning infrastructure safely and efficiently. Terraform can manage existing and popular service providers as well as custom in-house solutions.

Infrastructure as Code
Infrastructure is described using a high-level configuration syntax. This allows a blueprint of your datacenter to be versioned and treated as you would any other code. Additionally, infrastructure can be shared and re-used.

### Execution Plans
Terraform has a "planning" step where it generates an execution plan. The execution plan shows what Terraform will do when you call apply. This lets you avoid any surprises when Terraform manipulates infrastructure.

### Resource Graph
Terraform builds a graph of all your resources, and parallelizes the creation and modification of any non-dependent resources. Because of this, Terraform builds infrastructure as efficiently as possible, and operators get insight into dependencies in their infrastructure.

### Change Automation
Complex changesets can be applied to your infrastructure with minimal human interaction. With the previously mentioned execution plan and resource graph, you know exactly what Terraform will change and in what order, avoiding many possible human errors.

## Day's Notes

* In short, Terraform (bin) reads the definition file (HCL), compares to the state and generates or modifies the resources to mirror the configuration file.
* Terraform works in a descritive way, as in: you define how you want your resources to be configured, and Terraform makes sure the resources "get there"

## Extra reading

* https://www.terraform.io/intro/index.html
* https://www.hashicorp.com/resources/what-is-mutable-vs-immutable-infrastructure

--- 

# Understanding HCL (HashiCorp Configuration Language)

Topics aproached:
* Block syntax
  * Arguments
* Identifiers
* Provider

## Extra Reading

* https://www.terraform.io/docs/configuration/syntax.html

--- 

# Basic commands

Topics Approached:
* the file *.tfstate contains sensible information, that should not be contained localy, because other team members need to work with you. Because of that, it is recommended that we use remote (and secure) backend. Through this course we'll use AWS S3

## Commands

* terraform plan - The terraform plan command is used to create an execution plan. Terraform performs a refresh, unless explicitly disabled, and then determines what actions are necessary to achieve the desired state specified in the configuration files.
  * The optional -out argument can be used to save the generated plan to a file for later execution with terraform apply, which can be useful when running Terraform in automation [https://learn.hashicorp.com/tutorials/terraform/automate-terraform]
  * https://www.terraform.io/docs/commands/plan.html
  * terraform plan [options] [dir]
* terraform apply - The terraform apply command is used to apply the changes required to reach the desired state of the configuration, or the pre-determined set of actions generated by a terraform plan execution plan.
  * https://www.terraform.io/docs/commands/apply.html
  * terraform apply [options] [dir-or-plan]
* terraform destroy - Infrastructure managed by Terraform will be destroyed. This will ask for confirmation before destroying.
  * https://www.terraform.io/docs/commands/destroy.html
  * terraform destroy [options] [dir]

--- 

# Expressions & Console

Expressions are used to refer to or compute values within a configuration. The simplest expressions are just literal values, like "hello" or 5, but the Terraform language also allows more complex expressions such as references to data exported by resources, arithmetic, conditional evaluation, and a number of built-in functions.

## Notes

* Extra reading:
  * https://www.terraform.io/docs/configuration/expressions.html

## Commands

* terraform console
  * This command provides an interactive command-line console for evaluating and experimenting with expressions. This is useful for testing interpolations before using them in configurations, and for interacting with any values currently saved in state. If the current state is empty or has not yet been created, the console can be used to experiment with the expression syntax and built-in functions.
  * https://www.terraform.io/docs/commands/console.html
  * terraform console [options] [dir]


--- 

# Data

Data sources allow data to be fetched or computed for use elsewhere in Terraform configuration. Use of data sources allows a Terraform configuration to make use of information defined outside of Terraform, or defined by another separate Terraform configuration.

Each provider may offer data sources alongside its set of resource types.

## Notes

* Extra reading:
  * https://www.terraform.io/docs/configuration/data-sources.html

---

# Functions

The Terraform language includes a number of built-in functions that you can call from within expressions to transform and combine values. The general syntax for function calls is a function name followed by comma-separated arguments in parentheses

The Terraform language does not support user-defined functions, and so only the functions built in to the language are available for use. The navigation for this section includes a list of all of the available built-in functions.

## Notes:

* Extra Reading:
  * https://www.terraform.io/docs/configuration/expressions.html#function-calls
  * https://www.terraform.io/docs/configuration/functions.html

--- 

# Providers

Terraform is used to create, manage, and update infrastructure resources such as physical machines, VMs, network switches, containers, and more. Almost any infrastructure type can be represented as a resource in Terraform.

A provider is responsible for understanding API interactions and exposing resources. Most providers configure a specific infrastructure platform (either cloud or self-hosted). Providers can also offer local utilities for tasks like generating random numbers for unique resource names.

Every Terraform provider has its own documentation, describing its resource types and their arguments.

Terraform relies on plugins called "providers" to interact with remote systems.

Terraform configurations must declare which providers they require, so that Terraform can install and use them. Additionally, some providers require configuration (like endpoint URLs or cloud regions) before they can be used.

## Notes

* Extra Reading:
  * https://www.terraform.io/docs/configuration/providers.html
  * https://www.terraform.io/docs/configuration/providers.html#alias-multiple-provider-configurations

---

# Variables

Input variables serve as parameters for a Terraform module, allowing aspects of the module to be customized without altering the module's own source code, and allowing modules to be shared between different configurations.

When you declare variables in the root module of your configuration, you can set their values using CLI options and environment variables. When you declare them in child modules, the calling module should pass values in the module block.

If you're familiar with traditional programming languages, it can be useful to compare Terraform modules to function definitions:

* Input variables are like function arguments.
* Output values are like function return values.
* Local values are like a function's temporary local variables.

## Notes

* Extra Reading:
  * https://www.terraform.io/docs/configuration/variables.html

---

# Provisioners

Provisioners can be used to model specific actions on the local machine or on a remote machine in order to prepare servers or other infrastructure objects for service.

## Notes

* Extra Reading:
  * https://www.terraform.io/docs/provisioners/index.html
  * https://www.terraform.io/docs/provisioners/remote-exec.html
  * https://www.terraform.io/docs/provisioners/local-exec.html
  * https://www.terraform.io/docs/provisioners/connection.html
* Attention to the "self" object
* Should be used as a last resort
* TO-DO
  * Review Provisioners
